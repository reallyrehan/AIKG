if(!window.buckets)throw"dblp-recordpage.js: buckets.js library has not been loaded.";if(!window.encoder)throw"dblp-recordpage.js: encoder.js library has not been loaded.";if(!window.dblp)throw"dblp-recordpage.js: dblp.js has not been loaded.";dblp.recordpage=dblp.recordpage||{};dblp.recordpage.CROSSREF_API_URL="https://api.crossref.org/";dblp.recordpage.OCC_API_URL="https://opencitations.net/index/api/v1/";dblp.recordpage.SEMSCHOLAR_API_URL="https://api.semanticscholar.org/v1/";(function(mod,undefined){function extractDoi(url){var regex=/\b(10[.][0-9]{4,}\/.+)(\?|\b)/;var matches=regex.exec(url)||[undefined];return matches[0]}function extractArxiv(url){var parts=url.split("arxiv.org/abs/");return parts.length>1?parts[1]:undefined}function urldata(url,data){var result=url+"?";for(var prop in data){result+=encodeURIComponent(prop)+"="+encodeURIComponent(data[prop])+"&"}result=result.substring(0,result.length-1);return result}function linkify(text,info){if(info===undefined)info={};var result=text.replace("’","'");var auTokens=[];var auListPatternAPA=/^(((([A-zÀ-ž' -]+), ([A-ZÀ-Ž][.][- ]?)+), )*(& |and |… )?(([A-zÀ-ž' -]+), ([A-ZÀ-Ž][.][- ]?)+|et al\.?)( .[Ee]ds?\..\.)?( \([0-9]{4}\)). )/gm;var auPatternAPA=/(([A-zÀ-ž' -]+), ([A-ZÀ-Ž][.][- ]?(?!\())+)( \([0-9]{4}\))?/gm;var auListPatternEtAlY=/^(([A-zÀ-ž' -]+) [Ee]t [Aa]l\.? (\([0-9]{4}\)?[.])?)/gm;var auPatternEtAlY=/([A-zÀ-ž' -]+)( [Ee]t [Aa]l\.? (\([0-9]{4}\)?[.])?)/gm;var auListPattern1LFY=/^((([A-zÀ-ž' -]{2,})(, [A-zÀ-ž' .-]+)?)( .[Ee]ds?\..)?[.:]( [0-9]{4}[A-z]?[.])? )/gm;var auPattern1LFY=/(([A-zÀ-ž' -]{2,})(, [A-zÀ-ž' .-]+)?)(( .[Ee]ds?\..)?[.:] )/gm;var auListPattern1LF=/^((([A-zÀ-ž' -]{2,})(, [A-zÀ-ž' .-]+)?)( .[Ee]ds?\..)?[.:] )/gm;var auPattern1LF=/(([A-zÀ-ž' -]{2,})(, [A-zÀ-ž' .-]+)?)(( .[Ee]ds?\..)?[.:] )/gm;var auListPatternLF=/^(((([A-zÀ-ž' -]+), ([A-ZÀ-Ž][.][-]?)+), )*(([A-zÀ-ž' -]+), ([A-ZÀ-Ž][.][-]?)+|et al\.?)( .[Ee]ds?\..)?[.:] )/gm;var auPatternLF=/(([A-zÀ-ž' -]+), ([A-ZÀ-Ž][.][-]?)+)(, |( .[Ee]ds\..)?[.:] )/gm;var auListPatternFLY=/^((([A-ZÀ-Ž][.][ -])+([A-zÀ-ž' -]+),? )*(& |and )?(([A-ZÀ-Ž][.][ -])*([A-zÀ-ž' -]+).|et al\.?) [0-9]{4}\. )/gm;var auPatternFLY=/([A-ZÀ-Ž][A-zÀ-ž'. -]+)/gm;var auListPatternFL=/^((([A-ZÀ-Ž][.][ -])+([A-zÀ-ž' -]+),? )*(& |and )?(([A-ZÀ-Ž][.][ -])*([A-zÀ-ž' -]+).|et al\.?) )/gm;var auPatternFL=/([A-ZÀ-Ž][A-zÀ-ž'. -]+)/gm;try{if(auListPatternAPA.test(result)){var authors=result.match(auListPatternAPA)[0];auTokens=authors.match(auPatternAPA).map(function(x){return x.split(",")[0]});authors=authors.replace(auPatternAPA,"<author>$1</author>$4");result=result.replace(auListPatternAPA,authors+"<titlestart/>");info["parser"]="APA"}else if(auListPatternEtAlY.test(result)){var authors=result.match(auListPatternEtAlY)[0];auTokens=authors.match(auPatternEtAlY).map(function(x){return x.split(",")[0]});authors=authors.replace(auPatternEtAlY,"<author>$1</author>$2");result=result.replace(auListPatternEtAlY,authors+"<titlestart/>");info["parser"]="EtAlY"}else if(auListPattern1LFY.test(result)){var authors=result.match(auListPattern1LFY)[0];auTokens=authors.match(auPattern1LFY).map(function(x){return x.split(",")[0]});authors=authors.replace(auPattern1LFY,"<author>$1</author>$4");result=result.replace(auListPattern1LFY,authors+"<titlestart/>");info["parser"]="1LFY"}else if(auListPattern1LF.test(result)){var authors=result.match(auListPattern1LF)[0];auTokens=authors.match(auPattern1LF).map(function(x){return x.split(",")[0]});authors=authors.replace(auPattern1LF,"<author>$1</author>$4");result=result.replace(auListPattern1LF,authors+"<titlestart/>");info["parser"]="1LF"}else if(auListPatternLF.test(result)){var authors=result.match(auListPatternLF)[0];auTokens=authors.match(auPatternLF).map(function(x){return x.split(",")[0]});authors=authors.replace(auPatternLF,"<author>$1</author>$4");result=result.replace(auListPatternLF,authors+"<titlestart/>");info["parser"]="LF"}else if(auListPatternFLY.test(result)){var authors=result.match(auListPatternFLY)[0].slice(0,-8);authors=authors.replace(", and ",", ").replace(" and ",", ");auTokens=authors.match(auPatternFLY).map(function(x){var parts=x.replace(/[.,]/," ").replace("  "," ").split(/[ -]/);return parts.reduce(function(a,c){return a.length>=c.length?a:c})});authors=authors.match(auPatternFLY).map(function(x){return"<author>"+x+"</author>"});if(authors.length==1)authors=authors[0];else if(authors.length==2)authors=authors[0]+" and "+authors[1];else authors=authors.slice(0,-1).join(", ")+", and "+authors.slice(-1)[0];result=result.replace(auListPatternFLY,authors+". "+"<titlestart/>");info["parser"]="FLY"}else if(auListPatternFL.test(result)){var authors=result.match(auListPatternFL)[0].slice(0,-2);authors=authors.replace(", and ",", ").replace(" and ",", ");authors=authors.replace(", & ",", ").replace(" & ",", ");auTokens=authors.match(auPatternFL).map(function(x){var parts=x.replace(/[.,]/," ").replace("  "," ").split(/[ -]/);return parts.reduce(function(a,c){return a.length>=c.length?a:c})});authors=authors.match(auPatternFL).map(function(x){return"<author>"+x+"</author>"});if(authors.length==1)authors=authors[0];else if(authors.length==2)authors=authors[0]+" and "+authors[1];else authors=authors.slice(0,-1).join(", ")+", and "+authors.slice(-1)[0];result=result.replace(auListPatternFL,authors+". "+"<titlestart/>");info["parser"]="FL"}else info["parser"]=null}catch(ex){console.error("parsing error:",ex);if(dblp.TEAM_MODE_ENABLED||dblp.LEY_MODE_ENABLED||dblp.MRA_MODE_ENABLED){result='<span class="warning">(parsing fail)</span> '+result}}var titlePattern=/<titlestart\/>([^.!?]+[.!?])/gim;result=result.replace(titlePattern,"<br /><title>$1</title>");var updateFormat=dblp.TEAM_MODE_ENABLED||dblp.LEY_MODE_ENABLED||dblp.MRA_MODE_ENABLED?' <small><a style="color:#1889c4;" target="_blank" title="edit bib string stored im metadata DB"'+'href="https://dblps.uni-trier.de/~mra/cgi-bin/metadata/update.py?action=edit&doi=$1">[edit]</a></small>':"";var urlPattern=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;var doiPattern=/\bdoi:(10.[0-9]{4,}\/[^ ]+)/gim;var arxivPattern=/\barXiv:([0-9]+\.[0-9v]+)/gim;var auSearchPattern=/<author>([^<]*)<\/author>/gim;var tiSearchPattern=/<title>([^<]*)<\/title>/gim;result=result.replace(urlPattern,'<a href="$1">$1</a>').replace(doiPattern,'<a href="https://doi.org/$1">doi:$1</a>'+updateFormat).replace(arxivPattern,'<a href="https://arxiv.org/abs/$1">arXiv:$1</a>').replace(auSearchPattern,'<a href="'+dblp.BASE_URL+'/search/author?q=$1">$1</a>').replace(tiSearchPattern,'<span class="title">$1</span>');return result}function getPrimaryId(){var publSect=$("#publ-section");if(!publSect)return undefined;var doi=undefined;publSect.find("ul.publ-list li.entry:first-child nav.publ ul li:first-child .body ul li.ee a").each(function(){var href=$(this).attr("href");doi=extractDoi(href);return doi===undefined});if(doi===undefined)doi=publSect.data("doi");if(doi)return{type:"doi",id:doi.toUpperCase()};var arxiv=undefined;publSect.find("ul.publ-list li.entry:first-child nav.publ ul li:first-child .body ul li.ee a").each(function(){var href=$(this).attr("href");arxiv=extractArxiv(href);return arxiv===undefined});if(arxiv)return{type:"arXiv",id:arxiv};return undefined}function bulkRenderPubls(publList,doiArray,liHtml,missing){doiArray=typeof doiArray==="undefined"?[]:doiArray;liHtml=typeof liHtml==="undefined"?"":liHtml;missing=typeof missing==="undefined"?0:missing;var waiting=publList.parent().find(".waiting");var warning=publList.parent().find(".warning");publList.empty();var url=dblp.CS_PUBLS_DOI_INCLUDE_URL;var data={doi:doiArray.join(" ")};console.debug("render: loading "+url);publList.load(url+" ul.publ-list>li",data=data,function(responseText,textStatus,xmlHttpRequest){if(textStatus=="error"){publList.html('<p><em class="warning">service temporarily not available</em></p>');console.error("render: ["+xmlHttpRequest.status+"] "+xmlHttpRequest.statusText);warning.show()}else{if(liHtml)publList.append(liHtml);if(missing)publList.append("<li><em>further "+missing+" item(s) omitted due to insufficient open metadata</em></li>");var matches=publList.find("li.entry").length;var nonMatches=publList.find("li.doi").length;var textOnly=publList.find("li.text").length;if(matches)console.debug("render: "+matches+" DOI matches");if(nonMatches)console.debug("render: "+nonMatches+" DOI non-matches");if(textOnly)console.debug("render: "+textOnly+" text-only");if(missing)console.debug("render: "+missing+" missing")}console.info("render: done rendering");waiting.hide();publList.show()})}function chainedRenderPubls(publList,doiArray,liHtml,missing,itt){doiArray=typeof doiArray==="undefined"?[]:doiArray;liHtml=typeof liHtml==="undefined"?"":liHtml;missing=typeof missing==="undefined"?0:missing;itt=typeof itt==="undefined"?0:itt;var chunkSize=100;var timeoutMillis=1;var waiting=publList.parent().find(".waiting");var warning=publList.parent().find(".warning");if(itt==0)publList.empty();publList.show();if(doiArray===undefined||doiArray.length<1){if(liHtml)publList.append(liHtml);if(missing)publList.append("<li><em>further "+missing+" item(s) omitted due to insufficient open metadata</em></li>");var matches=publList.find("li.entry").length;var nonMatches=publList.find("li.doi").length;var textOnly=publList.find("li.text").length;if(matches)console.debug("render: "+matches+" DOI matches");if(nonMatches)console.debug("render: "+nonMatches+" DOI non-matches");if(textOnly)console.debug("render: "+textOnly+" text-only");if(missing)console.debug("render: "+missing+" missing");console.info("render: done rendering");waiting.hide()}else{var currentDois=doiArray.splice(0,chunkSize);var data={doi:currentDois.join(" ")};console.debug("render: processing DOIs #"+(itt*chunkSize+1)+"-#"+(itt*chunkSize+currentDois.length)+" of "+((itt+1)*chunkSize+doiArray.length));var url=dblp.CS_PUBLS_DOI_INCLUDE_URL;console.debug("render: loading "+url);var tmp=$("<ul>");tmp.load(url+" ul.publ-list>li",data=data,function(responseText,textStatus,xmlHttpRequest){if(textStatus=="error"){publList.html('<p><em class="warning">service temporarily not available</em></p>');console.error("render: ["+xmlHttpRequest.status+"] "+xmlHttpRequest.statusText);warning.show()}else{tmp.children("li.text").each(function(){if($(this).data("linkify")!="done"){var cite=$(this).find("cite.data");var meta={};var txt=linkify(cite.text(),meta);cite.html(txt);$(this).attr("data-linkify","done");$(this).attr("data-linkify-parser",meta["parser"])}});publList.append(tmp.children("li"));setTimeout(function(){chainedRenderPubls(publList,doiArray,liHtml,missing,itt+1)},timeoutMillis)}})}}async function renderCrossrefReferences(data,srcurl,publList,waiting){if(!data||!data.message||!data.message.reference||data.message.reference.length==0)return false;let data_field=data.message.reference;console.debug("references: found "+data_field.length+" on Crossref");var doiArray=[];var liHtml="";var i,missing=0;for(i=0;i<data_field.length;i++){try{if("DOI"in data_field[i]){var txt=data_field[i].DOI;if(txt.includes(" "))missing++;else doiArray.push(txt)}else if("unstructured"in data_field[i]){var meta={};var linked_txt=linkify(data_field[i].unstructured,meta);liHtml+='<li class="text" data-linkify="done" data-linkify-parser="'+meta["parser"]+'">'+'<img class="no-match" src="'+dblp.BASE_URL+'/img/no-match-found.110x16.png" />'+'<cite class="data">'+linked_txt+"</cite></li>"}else{var txt="";if("author"in data_field[i])txt+="<author>"+data_field[i].author+"</author> ";if("year"in data_field[i])txt+="("+data_field[i].year+"). ";if("article-title"in data_field[i])txt+="<br/><title>"+data_field[i]["article-title"]+".</title> ";else if("volume-title"in data_field[i])txt+="<br/><title>"+data_field[i]["volume-title"]+".</title> ";else{missing++;continue}if("journal-title"in data_field[i]){txt+=data_field[i]["journal-title"];if("volume"in data_field[i]){txt+=" "+data_field[i].volume;if("issue"in data_field[i])txt+="("+data_field[i].issue+")"}txt+=", "}if("first-page"in data_field[i])txt+="pp. "+data_field[i]["first-page"]+" ff. ";if(txt){var meta={};var linked_txt=linkify(txt,meta);liHtml+='<li class="text" data-linkify="done" data-linkify-parser="'+meta["parser"]+'">'+'<img class="no-match" src="'+dblp.BASE_URL+'/img/no-match-found.110x16.png" />'+'<cite class="data">'+linked_txt+"</cite></li>"}else missing++}}catch(ex){console.error("exception while parsing:",data_field[i],ex);missing++;continue}}if(doiArray.length<100)waiting.find("em").text("matching with dblp");else waiting.find("em").text("matching with dblp (this may take a while)");liHtml+='<li><em>source: <a href="'+srcurl+'">crossref.org</a></em></li>';await chainedRenderPubls(publList,doiArray,liHtml,missing);return true}async function renderOccData(data,refOrCit,srcurl,publList,waiting){if(refOrCit.startsWith("ref"))var field="cited";else if(refOrCit.startsWith("cit"))var field="citing";else return false;if(!data||data.length==0)return false;console.debug(refOrCit+": found "+data.length+" on OCC");var doiArray=[];var i;for(i=0;i<data.length;i++){doiArray.push(data[i][field].split(" => ")[1])}if(doiArray.length<100)waiting.find("em").text("matching with dblp");else waiting.find("em").text("matching with dblp (this may take a while)");var liHtml='<li><em>source: <a href="'+srcurl+'">opencitations.net</a></em></li>';await chainedRenderPubls(publList,doiArray,liHtml);return true}async function renderSemScholarData(data,refOrCit,srcurl,publList,waiting){if(refOrCit.startsWith("ref"))var field="references";else if(refOrCit.startsWith("cit"))var field="citations";else return false;if(!data||!field in data||data[field].length==0)return false;console.debug(field+": found "+data[field].length+" on semscholar");var doiArray=[];var liHtml="";var i,j,missing=0;for(i=0;i<data[field].length;i++){try{if("doi"in data[field][i]&&data[field][i].doi){var txt=data[field][i].doi;if(txt.includes(" "))missing++;else doiArray.push(txt)}else if("arxivId"in data[field][i]&&data[field][i].arxivId){var txt=data[field][i].arxivId;if(txt.includes(" "))missing++;else doiArray.push("arxiv:"+txt)}else{var txt="";if(data[field][i].authors&&data[field][i].authors.length>0){for(j=0;j<data[field][i].authors.length;j++){if(j>0)txt+=", ";txt+="<author>"+data[field][i].authors[j].name+"</author>"}txt+="<br/>"}if(data[field][i].title&&data[field][i].title.length>0)txt+="<title>"+data[field][i].title+".</title> ";else{missing++;continue}if(data[field][i].venue&&data[field][i].venue.length>0)txt+=data[field][i].venue+" ";if(data[field][i].year)txt+=data[field][i].year+". ";if(txt){var meta={};var linked_txt=linkify(txt,meta);liHtml+='<li class="text" data-linkify="done" data-linkify-parser="'+meta["parser"]+'">'+'<img class="no-match" src="'+dblp.BASE_URL+'/img/no-match-found.110x16.png" />'+'<cite class="data">'+linked_txt+"</cite></li>"}else missing++}}catch(ex){console.error("exception while parsing:",data_field[i],ex);missing++;continue}}if(doiArray.length<100)waiting.find("em").text("matching with dblp");else waiting.find("em").text("matching with dblp (this may take a while)");liHtml+='<li><em>source: <a href="'+srcurl+'">semanticscholar.org</a></em></li>';await chainedRenderPubls(publList,doiArray,liHtml,missing);return true}async function loadReferences(link){var dropdown=$("#publ-references-section").find("nav.header");var publList=$("#publ-references-section").find(".publ-list");var empty=publList.parent().find(".empty");var waiting=publList.parent().find(".waiting");var warning=publList.parent().find(".warning");if(link===undefined){if(publList.find("li").length==0)empty.show();return}dropdown.hide();publList.hide();empty.hide();waiting.show();warning.hide();var crefurl=dblp.recordpage.CROSSREF_API_URL+"works/"+link.id;var occurl=dblp.recordpage.OCC_API_URL+"references/"+link.id;var semsurl=dblp.recordpage.SEMSCHOLAR_API_URL+"paper/"+link.id;if(link.type=="arXiv")semsurl=dblp.recordpage.SEMSCHOLAR_API_URL+"paper/arXiv:"+link.id;waiting.find("em").text("looking up references");let done=false;if(!done&&link.type=="doi"){if(dblp.TEAM_MODE_ENABLED||dblp.LEY_MODE_ENABLED||dblp.MRA_MODE_ENABLED){$.post("https://dblps.uni-trier.de/~mra/cgi-bin/200.py?crossref")}console.debug("references: calling ",crefurl);try{let data=await $.ajax({url:crefurl+"?mailto="+dblp.AJAX_CONTACT_EMAIL,type:"GET",dataType:"json",crossDomain:true});done=await renderCrossrefReferences(data,crefurl,publList,waiting)}catch(error){console.error("exception while calling Crossref for references",error);done=false}}if(!done&&link.type=="doi"){if(dblp.TEAM_MODE_ENABLED||dblp.LEY_MODE_ENABLED||dblp.MRA_MODE_ENABLED){$.post("https://dblps.uni-trier.de/~mra/cgi-bin/200.py?opencitations")}console.debug("references: calling ",crefurl);try{let data=await $.ajax({url:occurl+"?format=json&exclude=cited&sort=desc(cited)&mailto="+dblp.AJAX_CONTACT_EMAIL,type:"GET",dataType:"json",crossDomain:true});done=await renderOccData(data,"refs",occurl,publList,waiting)}catch(error){console.error("exception while calling OCC for references",error);done=false}}if(!done&&(link.type=="doi"||link.type=="arXiv")){if(dblp.TEAM_MODE_ENABLED||dblp.LEY_MODE_ENABLED||dblp.MRA_MODE_ENABLED){$.post("https://dblps.uni-trier.de/~mra/cgi-bin/200.py?semanticscholar")}console.debug("references: calling ",semsurl);try{let data=await $.ajax({url:semsurl+"?include_unknown_references=true&mailto="+dblp.AJAX_CONTACT_EMAIL,type:"GET",dataType:"json",crossDomain:true});done=await renderSemScholarData(data,"refs",semsurl+"?include_unknown_references=true",publList,waiting)}catch(error){if(error.status!=404){console.error("exception while calling SemScholar for references",error)}done=false}}if(!done){waiting.hide();empty.show()}if(link.type=="doi"){dropdown.find("div.head a").attr("href",crefurl);dropdown.find("li.crossref.json a").attr("href",crefurl);dropdown.find("li.occ.json a").attr("href",occurl+"?format=json");dropdown.find("li.occ.csv a").attr("href",occurl+"?format=csv");dropdown.find("li.semscholar.json a").attr("href",semsurl+"?include_unknown_references=true");dropdown.show()}else if(link.type=="arXiv"){dropdown.find("div.head a").attr("href",semsurl+"?include_unknown_references=true");dropdown.find("li.crossref").hide();dropdown.find("li.occ").hide();dropdown.find("li.semscholar.json a").attr("href",semsurl+"?include_unknown_references=true");dropdown.show()}}function prepareReferences(){if($("#publ-references-section").length==0)return;var refSect=$("#publ-references-section");refSect.find(".privacy p").hide();refSect.find("#references-load").show();refSect.find(".waiting").hide();refSect.find(".empty").hide();refSect.find(".warning").hide();var button=refSect.find("#references-load");button.find("input").prop("checked",true);button.one("click","input, a",function(){$.cookie("dblp-references-load",false,{expires:dblp.COOKIE_EXPIRES_IN_DAYS});$("#references-load").find("input").prop("checked",false);$("#settings .references-load input").prop("checked",false);mod.initRecordReferenceSection()});$("#publ-references-section").on("mousedown","li.text>.no-match",function(event){var title=$(this).closest("li.text").find(".title").text();if(title.length<1)return;var url=urldata(dblp.BASE_URL+"/search/publ",{q:title});if(event.which==1)window.location.href=url;else if(event.which==2)window.open(url,"_blank")});$("#publ-references-section").on("mouseenter","li.text>img.no-match",function(){if($(this).closest("li.text").find(".title").length<1)return;$(this).css("cursor","pointer");$(this).attr("title","search dblp for this title");$(this).attr("src",dblp.BASE_URL+"/img/search-dblp.110x16.png")});$("#publ-references-section").on("mouseout","li.text>img.no-match",function(){if($(this).closest("li.text").find(".title").length<1)return;$(this).attr("src",dblp.BASE_URL+"/img/no-match-found.110x16.png")});loadReferences(getPrimaryId())}mod.initRecordReferenceSection=function(){if($("#publ-references-section").length==0)return;var dlMenu=$("#publ-references-section").find("header>nav");dlMenu.hide();var publList=$("#publ-references-section").find(".publ-list");publList.hide();var privacy=$("#publ-references-section").find(".privacy");if(privacy.length==0){var html='<div class="privacy">'+'<p id="references-load"><input type="checkbox">'+"<a>load references from crossref.org, opencitations.net, and semanticscholar.org</a></p>";html+="<p><b>Privacy notice:</b></p>";html+='<p>By enabling the option above, your browser will contact the APIs of <em>crossref.org</em>, <em>opencitations.net</em>, and <em>semanticscholar.org</em> to load citation information. Although we do not have any reason to believe that your call will be tracked, we do not have any control over how the remote server uses your data. So please proceed with care and consider checking the <a href="https://www.crossref.org/privacy/">Crossref privacy policy</a> and the <a href="https://opencitations.net/about">OpenCitations privacy policy</a>, as well as the <a href="https://allenai.org/privacy-policy">AI2 Privacy Policy</a> covering Semantic Scholar.</p>';html+="<p>Your decision whether to load or to not load citation data from externasl APIs will be stored by us in a cookie with your web browser and can be revoked at any time.</p>";html+="</div>";publList.before(html);html='<p class="waiting">'+"<em>looking up references</em> &nbsp; "+'<img src="'+dblp.BASE_URL+'/img/waiting.anim.gif" />'+"</p>"+'<p class="empty">'+"<em>no open data available, sorry</em>"+"</p>"+'<p class="warning">'+"<em>service temporarily unavailable, please try again later</em>"+"</p>";publList.after(html)}privacy=$("#publ-references-section").find(".privacy");privacy.find("p").show();privacy.show();publList.parent().find(".waiting").hide();publList.parent().find(".empty").hide();publList.parent().find(".warning").hide();var button=privacy.find("#references-load");button.css("vertical-align","middle");button.find("a").css("position","relative").css("top","-2px");button.find("input,a").css("cursor","pointer");if($.cookie("dblp-references-load")=="true"){prepareReferences();return}button.one("click","input, a",function(){$.cookie("dblp-references-load",true,{expires:dblp.COOKIE_EXPIRES_IN_DAYS});$("#settings .references-load input").prop("checked",true);prepareReferences()})};async function loadCitations(link){var dropdown=$("#publ-citations-section").find("nav.header");var publList=$("#publ-citations-section").find(".publ-list");var empty=publList.parent().find(".empty");var waiting=publList.parent().find(".waiting");var warning=publList.parent().find(".warning");if(link===undefined){if(publList.find("li").length==0)empty.show();return}dropdown.hide();publList.hide();empty.hide();waiting.show();warning.hide();var occurl=dblp.recordpage.OCC_API_URL+"citations/"+link.id;var semsurl=dblp.recordpage.SEMSCHOLAR_API_URL+"paper/"+link.id;if(link.type=="arXiv")semsurl=dblp.recordpage.SEMSCHOLAR_API_URL+"paper/arXiv:"+link.id;waiting.find("em").text("looking up citations");let done=false;if(!done&&link.type=="doi"){if(dblp.TEAM_MODE_ENABLED||dblp.LEY_MODE_ENABLED||dblp.MRA_MODE_ENABLED){$.post("https://dblps.uni-trier.de/~mra/cgi-bin/200.py?opencitations")}console.debug("citations: calling ",occurl);try{let data=await $.ajax({url:occurl+"?format=json&exclude=citing&sort=desc(creation)&mailto="+dblp.AJAX_CONTACT_EMAIL,type:"GET",dataType:"json",crossDomain:true});done=await renderOccData(data,"cites",occurl,publList,waiting)}catch(error){console.error("exception while calling OCC for citations",error);done=false}}if(!done&&(link.type=="doi"||link.type=="arXiv")){if(dblp.TEAM_MODE_ENABLED||dblp.LEY_MODE_ENABLED||dblp.MRA_MODE_ENABLED){$.post("https://dblps.uni-trier.de/~mra/cgi-bin/200.py?semanticscholar")}console.debug("citations: calling ",semsurl);try{let data=await $.ajax({url:semsurl+"?include_unknown_references=true&mailto="+dblp.AJAX_CONTACT_EMAIL,type:"GET",dataType:"json",crossDomain:true});done=await renderSemScholarData(data,"cites",semsurl+"?include_unknown_references=true",publList,waiting)}catch(error){if(error.status!=404){console.error("exception while calling SemScholar for citations",error)}done=false}}if(!done){waiting.hide();empty.show()}if(link.type=="doi"){dropdown.find("div.head a").attr("href",occurl+"?format=json");dropdown.find("li.crossref").hide();dropdown.find("li.occ.json a").attr("href",occurl+"?format=json");dropdown.find("li.occ.csv a").attr("href",occurl+"?format=csv");dropdown.find("li.semscholar.json a").attr("href",semsurl+"?include_unknown_references=true");dropdown.show()}else if(link.type=="arXiv"){dropdown.find("div.head a").attr("href",semsurl+"?include_unknown_references=true");dropdown.find("li.crossref").hide();dropdown.find("li.occ").hide();dropdown.find("li.semscholar.json a").attr("href",semsurl+"?include_unknown_references=true");dropdown.show()}}function prepareCitations(){if($("#publ-citations-section").length==0)return;var citeSect=$("#publ-citations-section");citeSect.find(".privacy p").hide();citeSect.find("#citations-load").show();citeSect.find(".waiting").hide();citeSect.find(".empty").hide();citeSect.find(".warning").hide();var button=citeSect.find("#citations-load");button.find("input").prop("checked",true);button.one("click","input, a",function(){$.cookie("dblp-citations-load",false,{expires:dblp.COOKIE_EXPIRES_IN_DAYS});$("#citations-load").find("input").prop("checked",false);$("#settings .citations-load input").prop("checked",false);mod.initRecordCitationSection()});$("#publ-citations-section").on("mousedown","li.text>.no-match",function(event){var title=$(this).closest("li.text").find(".title").text();if(title.length<1)return;var url=urldata(dblp.BASE_URL+"/search/publ",{q:title});if(event.which==1)window.location.href=url;else if(event.which==2)window.open(url,"_blank")});$("#publ-citations-section").on("mouseenter","li.text>img.no-match",function(){if($(this).closest("li.text").find(".title").length<1)return;$(this).css("cursor","pointer");$(this).attr("title","search dblp for this title");$(this).attr("src",dblp.BASE_URL+"/img/search-dblp.110x16.png")});$("#publ-citations-section").on("mouseout","li.text>img.no-match",function(){if($(this).closest("li.text").find(".title").length<1)return;$(this).attr("src",dblp.BASE_URL+"/img/no-match-found.110x16.png")});loadCitations(getPrimaryId())}mod.initRecordCitationSection=function(){if($("#publ-citations-section").length==0)return;var dlMenu=$("#publ-citations-section").find("header>nav");dlMenu.hide();var publList=$("#publ-citations-section").find(".publ-list");publList.hide();var privacy=$("#publ-citations-section").find(".privacy");if(privacy.length==0){var html='<div class="privacy">'+'<p id="citations-load"><input type="checkbox">'+"<a>load citations from opencitations.net and semanticscholar.org</a></p>";html+="<p><b>Privacy notice:</b></p>";html+='<p>By enabling the option above, your browser will contact the APIs of <em>opencitations.net</em> and <em>semanticscholar.org</em> to load citation information. Although we do not have any reason to believe that your call will be tracked, we do not have any control over how the remote server uses your data. So please proceed with care and consider checking the <a href="https://opencitations.net/about">OpenCitations privacy policy</a> as well as the <a href="https://allenai.org/privacy-policy">AI2 Privacy Policy</a> covering Semantic Scholar.</p>';html+="<p>Your decision whether to load or to not load citation data from external APIs will be stored by us in a cookie with your web browser and can be revoked at any time.</p>";html+="</div>";publList.before(html);html='<p class="waiting">'+"<em>looking up citations</em> &nbsp; "+'<img src="'+dblp.BASE_URL+'/img/waiting.anim.gif" />'+"</p>"+'<p class="empty">'+"<em>no open data available, sorry</em>"+"</p>"+'<p class="warning">'+"<em>service temporarily unavailable, please try again later</em>"+"</p>";publList.after(html)}privacy=$("#publ-citations-section").find(".privacy");privacy.find("p").show();privacy.show();publList.parent().find(".waiting").hide();publList.parent().find(".empty").hide();publList.parent().find(".warning").hide();var button=privacy.find("#citations-load");button.css("vertical-align","middle");button.find("a").css("position","relative").css("top","-2px");button.find("input,a").css("cursor","pointer");if($.cookie("dblp-citations-load")=="true"){prepareCitations();return}button.one("click","input, a",function(){$.cookie("dblp-citations-load",true,{expires:dblp.COOKIE_EXPIRES_IN_DAYS});$("#settings .citations-load input").prop("checked",true);prepareCitations()})};var queryFinish=function(){var publSect=$("#publ-section");var matches=publSect.find("ul.publ-list>li.entry").length;if(matches==0)publSect.find(".empty").show();else publSect.find(".empty").hide();publSect.find(".waiting").hide();prepareCitations();prepareReferences()};var queryDBLP=function(query){console.debug("checking for dblp key query");var publSect=$("#publ-section");var key=query.trim();if(typeof key!="string"||!key.includes("/")){queryFinish(query);return}$("#publ-references-section").show();$("#publ-citations-section").show();var url=dblp.BASE_URL+"/rec/inc/"+key;console.debug("publs: loading "+url);publSect.find("ul.publ-list").load(url+" ul.publ-list>li.entry",function(responseText,textStatus,xmlHttpRequest){if(textStatus=="error"){if(xmlHttpRequest.status!=404){publSect.find(".warning").show();console.error("publs: ["+xmlHttpRequest.status+"] "+xmlHttpRequest.statusText);queryFinish();return}}else{}var matches=publSect.find("ul.publ-list>li.entry[id]").length;console.log("publs: "+matches+" matches retrieved");console.info("done checking for dblp key");if(matches==0){queryFinish(query)}else{publSect.find(".waiting").hide();queryFinish()}})};var queryISBN=function(query){console.debug("checking for ISBN query");var publSect=$("#publ-section");var isbn=query.replace(/[^0-9xX]/g,"");if(isbn.length!=10&&isbn.length!=13){queryDBLP(query);return}$("#publ-references-section").show();$("#publ-citations-section").show();var url=dblp.BASE_URL+"/search/publ/inc";var data={eid:"ISBN:"+isbn.toUpperCase(),h:1e3};console.debug("publs: loading "+urldata(url,data));publSect.find("ul.publ-list").load(urldata(url,data)+" ul.publ-list>li.entry",function(responseText,textStatus,xmlHttpRequest){if(textStatus=="error"){publSect.find(".warning").show();console.error("publs: ["+xmlHttpRequest.status+"] "+xmlHttpRequest.statusText);queryFinish();return}else{}var matches=publSect.find("ul.publ-list>li.entry[id]").length;console.log("publs: "+matches+" matches retrieved");console.info("done checking for ISBN");if(matches==0){queryDBLP(query)}else{publSect.find(".waiting").hide();queryFinish()}})};var queryDOI=function(query){console.debug("checking for DOI query");var publSect=$("#publ-section");var doi=extractDoi(query);if(doi===undefined){queryISBN(query);return}$("#publ-references-section").show();$("#publ-citations-section").show();var url=dblp.BASE_URL+"/search/publ/inc";var data={eid:"DOI:"+doi.toUpperCase(),h:1e3};console.debug("publs: loading "+urldata(url,data));publSect.find("ul.publ-list").load(urldata(url,data)+" ul.publ-list>li.entry",function(responseText,textStatus,xmlHttpRequest){if(textStatus=="error"){publSect.find(".warning").show();console.error("publs: ["+xmlHttpRequest.status+"] "+xmlHttpRequest.statusText);queryFinish();return}else{}var matches=publSect.find("ul.publ-list>li.entry[id]").length;console.log("publs: "+matches+" matches retrieved");console.info("done checking for DOI");if(matches==0){queryISBN(query)}else{publSect.find(".waiting").hide();publSect.data("doi",doi);queryFinish()}})};var queryStart=function(millisecs){var publSect=$("#publ-section");var input=$("#rec-lookup-form input");clearTimeout(input.data("queryTimer"));if(input.val().trim().length==0)return;var query=input.val().trim();var queryTimer=setTimeout(function(){console.debug("query update triggered");var query=input.val().trim();if(query.length>0){publSect.removeData("doi");publSect.find(".publ-list").empty();publSect.find(".waiting").show();publSect.find(".empty").hide();publSect.find(".warning").hide();$("#publ-references-section").hide();$("#publ-references-section .publ-list").empty();$("#publ-references-section .empty").show();$("#publ-citations-section").hide();$("#publ-citations-section .publ-list").empty();$("#publ-citations-section .empty").hide();queryDOI(query)}},millisecs);input.data("queryTimer",queryTimer)};mod.initRecordLookupSection=function(){if($("#rec-lookup-query").length==0)return;var html='<p class="waiting">'+"<em>looking for matches</em> &nbsp; "+'<img src="'+dblp.BASE_URL+'/img/waiting.anim.gif" />'+"</p>"+'<p class="empty">'+"<em>no match found</em>"+"</p>"+'<p class="warning">'+"<em>service temporarily unavailable, please try again later</em>"+"</p>";var publSect=$("#publ-section");publSect.append(html);publSect.find(".waiting").hide();publSect.find(".empty").show();publSect.find(".warning").hide();$("#publ-references-section").hide();$("#publ-citations-section").hide();var form=$("#rec-lookup-form");var input=$("#rec-lookup-input input");var clear=$("#rec-lookup-input .clear");clear.hide();var lookup=$("#rec-lookup-form .lookup");lookup.hide();input.on("input",function(event){var query=input.val().trim();var qlen=query.length;if(qlen==0)clear.hide();else clear.show();var doi=extractDoi(query);var isbn=query.replace(/[^0-9xX]/g,"");var key=query.trim();if(doi!==undefined){lookup.attr("href","https://doi.org/"+doi);lookup.show()}else if(isbn.length==10||isbn.length==13){lookup.attr("href","https://www.worldcat.org/isbn/"+isbn);lookup.show()}else{lookup.removeAttr("href");lookup.hide()}queryStart(dblp.UX_TYPING_QUERY_DELAY_MSECS(qlen))});form.submit(function(event){queryStart(0);event.preventDefault()});input.css("padding-right","40px");clear.css("position","absolute");clear.css("cursor","pointer");clear.css("top","50%");clear.css("margin-top","-8px");clear.css("right","6px");clear.css("z-index","11");clear.hide();clear.click(function(){publSect.find(".publ-list").empty();publSect.find(".waiting").hide();publSect.find(".empty").show();publSect.find(".warning").hide();$("#publ-references-section").hide();$("#publ-citations-section").hide();clear.hide();lookup.hide();input.val("");input.get(0).focus()});if(input.val().trim().length>0){clear.show();var query=input.val().trim();var doi=extractDoi(query);var isbn=query.replace(/[^0-9xX]/g,"");var key=query.trim();if(doi!==undefined){lookup.attr("href","https://doi.org/"+doi);lookup.show()}else if(isbn.length==10||isbn.length==13){lookup.attr("href","https://www.worldcat.org/isbn/"+isbn);lookup.show()}else{lookup.removeAttr("href");lookup.hide()}queryStart(0)}lookup.css("margin","4px");lookup.css("vertical-align","middle");lookup.click(function(event){if(lookup.attr("href")===undefined)event.preventDefault()})};mod.init=function(){console.debug("start initializing recordpage functions");mod.initRecordReferenceSection();mod.initRecordCitationSection();mod.initRecordLookupSection();console.debug("done initializing recordpage functions")}})(dblp.recordpage);$(document).ready(dblp.recordpage.init());
